[gd_scene load_steps=20 format=2]

[ext_resource path="res://our_environment.tres" type="Environment" id=1]
[ext_resource path="res://Logic/Player.tscn" type="PackedScene" id=2]
[ext_resource path="res://Assets/Sprites/Textures/GrassMatMaker_albedo.png" type="Texture" id=3]
[ext_resource path="res://Prototyping/TestLevelWagonCurve.tres" type="Curve3D" id=4]
[ext_resource path="res://Objects/Actors/Wagon.tscn" type="PackedScene" id=5]
[ext_resource path="res://Prototyping/TestLevel.gd" type="Script" id=6]
[ext_resource path="res://Objects/Environment/Tree.tscn" type="PackedScene" id=7]
[ext_resource path="res://Objects/Items/Log.tscn" type="PackedScene" id=8]
[ext_resource path="res://Objects/Items/Plant.tscn" type="PackedScene" id=9]
[ext_resource path="res://Assets/Sprites/Textures/GrassMatMaker_normal.png" type="Texture" id=10]
[ext_resource path="res://Assets/Sprites/map_path_mask.png" type="Texture" id=11]
[ext_resource path="res://Assets/Sprites/Textures/DirtMatMaker_albedo.png" type="Texture" id=12]
[ext_resource path="res://Assets/Sprites/Textures/DirtMatMaker_normal.png" type="Texture" id=13]
[ext_resource path="res://Logic/Enemy/EnemySpawner.tscn" type="PackedScene" id=14]
[ext_resource path="res://Objects/Actors/WaterEnemy.tscn" type="PackedScene" id=15]

[sub_resource type="QuadMesh" id=7]

[sub_resource type="Shader" id=5]
code = "// NOTE: Shader automatically converted from Godot Engine 3.4.3.stable's SpatialMaterial.

shader_type spatial;
render_mode blend_mix,depth_draw_opaque,cull_back,diffuse_burley,specular_schlick_ggx;
uniform vec4 albedo : hint_color;
uniform sampler2D grass_texture_albedo : hint_albedo;
uniform sampler2D grass_texture_normal : hint_normal;
uniform sampler2D dirt_texture_albedo : hint_albedo;
uniform sampler2D dirt_texture_normal : hint_normal;
uniform sampler2D ground_mask;
uniform float specular;
uniform float metallic;
uniform float roughness : hint_range(0,1);
uniform float point_size : hint_range(0,128);

uniform float normal_scale : hint_range(-16,16);
uniform vec3 uv1_scale;
uniform vec3 uv1_offset;

uniform vec2 tex_scale;


void vertex() {
	UV=UV*uv1_scale.xy+uv1_offset.xy;
}




void fragment() {
	float mix_factor = smoothstep(0.0, 0.2, texture(ground_mask, UV).r);
	vec4 albedo_tex = mix(texture(grass_texture_albedo, UV*tex_scale), texture(dirt_texture_albedo, UV*tex_scale), mix_factor);
	vec4 normal_tex = mix(texture(grass_texture_normal, UV*tex_scale), texture(dirt_texture_normal, UV*tex_scale), mix_factor);
	ALBEDO = albedo_tex.rgb;
	METALLIC = metallic;
	ROUGHNESS = roughness;
	SPECULAR = specular;
	NORMALMAP = normal_tex.rgb;
	NORMALMAP_DEPTH = normal_scale;
	
	
}
"

[sub_resource type="ShaderMaterial" id=6]
shader = SubResource( 5 )
shader_param/albedo = Color( 1, 1, 1, 1 )
shader_param/specular = 0.5
shader_param/metallic = 0.0
shader_param/roughness = 1.0
shader_param/point_size = 1.0
shader_param/normal_scale = 1.0
shader_param/uv1_scale = Vector3( 1, 1, 1 )
shader_param/uv1_offset = Vector3( 0, 0, 0 )
shader_param/tex_scale = Vector2( 20, 20 )
shader_param/grass_texture_albedo = ExtResource( 3 )
shader_param/grass_texture_normal = ExtResource( 10 )
shader_param/dirt_texture_albedo = ExtResource( 12 )
shader_param/dirt_texture_normal = ExtResource( 13 )
shader_param/ground_mask = ExtResource( 11 )

[sub_resource type="ConcavePolygonShape" id=8]
data = PoolVector3Array( -0.5, -0.5, 0, -0.5, 0.5, 0, 0.5, 0.5, 0, -0.5, -0.5, 0, 0.5, 0.5, 0, 0.5, -0.5, 0 )

[node name="TestLevel" type="Spatial"]
script = ExtResource( 6 )

[node name="Ground" type="MeshInstance" parent="."]
transform = Transform( 64.1972, 0.00865116, 1.76715e-10, 0, -2.80615e-06, 30, 0.00865116, -64.1972, -1.31134e-06, 0, 0, 7.37393 )
mesh = SubResource( 7 )
material/0 = SubResource( 6 )

[node name="StaticBody" type="StaticBody" parent="Ground"]

[node name="CollisionShape" type="CollisionShape" parent="Ground/StaticBody"]
shape = SubResource( 8 )

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = ExtResource( 1 )

[node name="Moon" type="DirectionalLight" parent="."]
transform = Transform( -0.866046, -0.209412, 0.453994, 0.00646802, 0.903285, 0.428993, -0.499922, 0.374464, -0.780932, 0, 6.51142, 2.99369 )
light_color = Color( 0.490196, 0.666667, 1, 1 )
light_energy = 0.105
shadow_enabled = true
shadow_color = Color( 0.384314, 0.384314, 0.384314, 1 )

[node name="Player" parent="." instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -12.4105, 0.353998, -0.788541 )

[node name="RemoteTransform" type="RemoteTransform" parent="Player"]
transform = Transform( 1, 0, 0, 0, 0.707107, -0.707107, 0, 0.707107, 0.707107, 0, 1.10269, 0 )
remote_path = NodePath("../../Pivot")
update_rotation = false
update_scale = false

[node name="Pivot" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 0.5, 0.866026, 0, -0.866026, 0.5, -12.4105, 1.45669, -0.788541 )

[node name="Camera" type="Camera" parent="Pivot"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 7 )
current = true

[node name="Wagon" parent="." instance=ExtResource( 5 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.00918525, 0 )
wagon_path = NodePath("../WagonPath")

[node name="WagonPath" type="Path" parent="."]
transform = Transform( 0.999999, 0, 0, 0, 1, 0, 0, 0, 0.999999, 0, 0, 0 )
curve = ExtResource( 4 )

[node name="EnemySpawner" parent="." instance=ExtResource( 14 )]

[node name="Environment" type="Spatial" parent="."]

[node name="Tree2" parent="Environment" instance=ExtResource( 7 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2.68382, 0.0540286, -24.5684 )

[node name="Tree" parent="Environment" instance=ExtResource( 7 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -3.74471, 0.0540291, -12.6243 )

[node name="Log" parent="Environment" instance=ExtResource( 8 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.913687, 0.0977135, -13.0104 )

[node name="Log2" parent="Environment" instance=ExtResource( 8 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1.02963, 0.0977135, -12.6322 )

[node name="Log3" parent="Environment" instance=ExtResource( 8 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 6.82041, 0.0977136, -11.9905 )

[node name="Log4" parent="Environment" instance=ExtResource( 8 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 1.9676, 0.0977132, -19.0448 )

[node name="Log5" parent="Environment" instance=ExtResource( 8 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.37874, 0.0977135, -13.9333 )

[node name="Log6" parent="Environment" instance=ExtResource( 8 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.218701, 0.0977136, -11.806 )

[node name="Plant" parent="Environment" instance=ExtResource( 9 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 3.83848, -0.29398, -8.22569 )

[node name="WaterEnemy" parent="." instance=ExtResource( 15 )]
transform = Transform( -0.835088, 0, -0.550116, 0, 1, 0, 0.550116, 0, -0.835088, -10.6627, 0, 1.2056 )
